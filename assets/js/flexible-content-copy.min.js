!function(e,t,i){"use strict";function l(){var t=e(window).height(),i=e("#TB_ajaxContent"),l=Math.round(t/100*85),n=Math.round(t/100*50);i.css("max-height",l+"px"),i.css("min-height",n+"px")}var n=i.Model.extend(),o=i.Model.extend({url:FlexibleContentCopyLocalize.url}),s=i.Collection.extend({model:n,url:FlexibleContentCopyLocalize.url,parse:function(e){return 0==e.length&&this.trigger("reset"),e}}),a={};t.extend(a,i.Events);var h=i.View.extend({className:"flexible-content-copy-dialog",template:t.template(e("#flexible-content-copy-template").html()),initialize:function(e){this.field=e.field,void 0===this.field&&console.error("No field id. Saving impossible"),this.collection=new s,this.listenTo(this.collection,"reset",this.renderSearchResult,this),a.bind("detail",this.toggleDetail,this),this.render()},render:function(){return this.$el.html(this.template()),this},changeSearchStatus:function(e){e?(this.$el.find(".status-text").removeClass("empty"),this.$el.find(".status-text").html('<img src="'+FlexibleContentCopyLocalize.loader+'">'),this.$el.find('input[type="search"]').prop("disabled",!0)):(this.$el.find(".status-text").addClass("empty"),this.$el.find(".status-text").html(""),this.$el.find('input[type="search"]').prop("disabled",!1))},renderSearchResult:function(){this.cleanSearchResult(),this.collection.each(this.renderResultRow,this)},renderResultRow:function(e){var t=new r({model:e});this.$el.find(".search-result tbody").append(t.render().el)},cleanSearchResult:function(){this.$el.find(".search-result .result-row").remove()},toggleDetail:function(e){this.removeDetails();var i=new o({id:e.model.get("id"),title:e.model.get("title"),formUrl:FlexibleContentCopyLocalize.url+"?action=flexible-content-copy/save",field:this.field}),l=new c({model:i});this.$el.append(l.render().el),t.defer(function(){l.show()})},removeDetails:function(){this.$el.find(".post-detail-view").remove()},events:{'change input[type="search"]':"onSearch"},onSearch:function(){this.changeSearchStatus(!0),this.collection.reset(),this.removeDetails();var e=this;this.collection.fetch({reset:!0,data:{action:"flexible-content-copy/load-posts",q:this.$el.find('input[type="search"]').val()},success:function(){e.changeSearchStatus(!1)}})}}),r=i.View.extend({tagName:"tr",className:"result-row",template:t.template(e("#flexible-content-copy-row-template").html()),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},events:{"click .post-title":"onRowClick"},onRowClick:function(){a.trigger("detail",this)}}),c=i.View.extend({className:"post-detail-view",template:t.template(e("#flexible-content-copy-detail-template").html()),initialize:function(){this.height=e("#TB_ajaxContent").innerHeight()-10,this.listenTo(this.model,"change",this.renderLayouts,this),this.model.fetch({data:{action:"flexible-content-copy/layouts",post:this.model.get("id")}})},render:function(){var e=this.model.toJSON();return e.height=this.height,this.$el.html(this.template(e)),this},renderLayouts:function(){this.$el.find("#layouts-list").empty();var e="",i=this.model.get("layouts");i.length?(t.each(i,function(i){e+=t.template('<li><label><input type="checkbox" name="flexible[<%= name %>-<%= order %>]">&nbsp;<%= label %></label></li>',i)}),this.$el.find("#layouts-list").html(e)):this.$el.find("#layouts-list").html("<li>No layouts</li>")},show:function(){this.$el.animate({"margin-right":"0"},400)},events:{"click .close":"onClose","click .button-primary":"onSubmit"},onClose:function(){return this.$el.animate({"margin-right":"-=5000"},500),!1},onSubmit:function(){this.$el.find("form").submit()}}),d=i.View.extend({initialize:function(i){this.fieldArray=i.field.split("_"),2==this.fieldArray.length&&(this.field=this.fieldArray[1],delete this.fieldArray,delete i.field,this.template=t.template(e("#flexible-content-copy").html()),this.render())},render:function(){return this.$el.append(this.template()),this},events:{"click .open-dialog":"onOpenDialog"},onOpenDialog:function(){this.dialogView=new h({field:this.field});var t=this.dialogView.render().$el;return e("#flexible-content-copy-dialog").html(t),tb_show("Flexible Content Copy","#TB_inline?inlineId=flexible-content-copy-dialog",!1),t.find('input[type="search"]').focus(),l(),!1}});e(window).resize(function(){l()}),e(window).load(function(){var i=e(".acf-field-flexible-content").attr("data-key");void 0!==i&&(t.isArray(i)?console.log("not supported yet"):new d({el:'.acf-field-flexible-content[data-key="'+i+'"] .values ~ ul.acf-hl',field:i}))})}(jQuery,_,Backbone);